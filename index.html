<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Bus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-WfpA6XxMFUnkpwYmNp/ItwMmuUaQOULiywzCW7bcUjA=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WfpA6XxMFUnkpwYmNp/ItwMluUaQOULiywzCW7bcUjA=" crossorigin="">
  </script>
</head>
    <style>    
     body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        main {
            padding: 20px;
        }
        form {
            margin-top: 20px;
        }
        
        input[type="text"], button {
            padding: 10px;
            margin-right: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        /* Custom styles for centering and attractiveness */
        .centered-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .form-container {
            width: 80%;
            max-width: 500px;
        }
        /* Custom styles for the map container */
        #map {
            height: 400px;
            width: 100%;
        }
        #trackForm label {
    text-align: right;
    flex-shrink: 0;
        }

        /* Adjustments for responsiveness */
        @media (max-width: 768px) {
            .form-container {
                width: 100%;
                max-width: 100%;
            }
            #trackForm input[type="text"] {
                width: 100%;
            }
            #trackForm button {
                width: 100%;
                margin-top: 10px;
            }
            .bus-info {
                text-align: center;
            }
}

#trackForm input[type="text"] {
    width: 50%;
    flex-grow: 1;
}

#trackForm button {
    flex-shrink: 0;
}
.container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        
    </style>

<body>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyDBOA_8ILXj-gheePc1LwkMW2H1nPwMQrw",
          authDomain: "gonav-9a614.firebaseapp.com",
          databaseURL: "https://gonav-9a614-default-rtdb.firebaseio.com",
          projectId: "gonav-9a614",
          storageBucket: "gonav-9a614.appspot.com",
          messagingSenderId: "259436553742",
          appId: "1:259436553742:web:90d8ddbd7b66f45754fe5f",
          measurementId: "G-VQPGBMN9CB"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
      </script>


<div class="container">
    <h1 class="text-center mt-5">Track Your Bus</h1>
    <p class="text-center mb-5">Enter your Bus No. to track its current location and estimated time of arrival.</p>
    <form id="trackForm" class="text-center mb-5">
        <div class="d-flex justify-content-end align-items-center mb-3">
            <label for="bus-id" class="mr-2">Bus No: </label>
            <div class="form-group col-auto">
                <input type="text" id="bus-id" name="bus-id" class="form-control" style="width: 100%;">
            </div>
            <button type="submit" class="btn btn-primary ml-2">Track</button>
        </div>
    </form>
</div>
<!-- Google Maps Container -->
<div class="map-container rounded shadow-sm" style="height: 500px;">
    <iframe
    width="100%"
    height="100%"
    loading="lazy"
    allowfullscreen
    referrerpolicy="no-referrer-when-downgrade"
    src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA5mgKso-881CnbbdhHB4hXAOOYc7sMIP0&q=Space+Needle,Seattle+WA">
    </iframe>
</div>

    <script>
        // Example: Track a page view
        logEvent(analytics, 'page_view', {
         page_location: window.location.href,
         page_path: window.location.pathname,
         page_title: document.title,
        });
    
        // Example: Track a button click event
        document.getElementById('myButton').addEventListener('click', () => {
         logEvent(analytics, 'button_click', {
             button_id: 'myButton',
             button_name: 'Submit',
         });
        });
    
        // Example: Set user properties
        setUserProperties(analytics, {
         sign_up_method: 'email',
        });
    
        // Example: Track user engagement on a specific screen
        setCurrentScreen(analytics, 'Home');
    
        // Reference to bus location data in Firebase Realtime Database
        const busDataRef = ref(database, 'busLocations');
    
        // Initialize Leaflet map
        var map = L.map('map-container').setView([34.0522, -118.2437], 13); // Example coordinates
    
        // Add base layer (replace with your preferred tile provider)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
        // Function to listen for changes in bus locations (real-time updates)
        function listenForBusLocations() {
          onValue(busDataRef, (snapshot) => {
            const busLocations = []; // Initialize an empty array to store bus data
    
            // Extract data from the snapshot
            snapshot.forEach((childSnapshot) => {
              const busData = childSnapshot.val(); // Get data for each bus
              busLocations.push(busData); // Add bus data to the array
            });
    
            try {
              // Update bus markers and information if data is valid
              updateBusMarkers(busLocations);
            } catch (error) {
              console.error("Error fetching bus data:", error);
              // Handle the error gracefully, e.g., display an error message to the user
            }
          });
        }
    
        // Function to update bus information section
        function updateBusInfo(busData) {
          document.getElementById("bus-info-id").textContent = busData.id;
          document.getElementById("bus-info-route").textContent = busData.route;
          // You can similarly update next stop and ETA based on your data structure
        }
    
        // Function to find a specific bus by number and update map/info
        function findBus() {
          const busNumber = document.getElementById("bus-number").value;
    
          if (!busNumber) {
            alert("Please enter a bus number to search.");
            return;
          }
    
          // Create a query to filter bus data based on bus number
          const busQuery = query(busDataRef, orderByChild('id'), equalTo(busNumber));
    
          onValue(busQuery, (snapshot) => {
            const foundBuses = [];
    
            // Check if any bus matches the search criteria
            snapshot.forEach((childSnapshot) => {
              foundBuses.push(childSnapshot.val());
            });
    
            if (foundBuses.length > 0) {
              // Clear existing markers and update with the found bus
              map.eachLayer(function(layer) {
                if (layer instanceof L.marker) {
                  map.removeLayer(layer);
                }
              });
    
              const busData = foundBuses[0]; // Assuming the first bus for now
              updateBusMarkers([busData]); // Update markers with the found bus data
              updateBusInfo(busData); // Update information section
            } else {
              alert("Bus not found. Please try a different number.");
            }
          });
        }
    
        // Call listenForBusLocations to start listening for real-time updates
        listenForBusLocations();
      </script>
    
    

    <script>
    // Select the form using its ID
const form = document.getElementById('trackForm');

// Attach an event listener for the 'submit' event
form.addEventListener('submit', function(event) {
    // Prevent the form from submitting normally
    event.preventDefault();

    // Your code to handle the form submission goes here
    console.log('Form submitted');
});
    </script>

<script>
form.addEventListener('submit', function(event) {
    event.preventDefault();

    // Gather form data
    const formData = new FormData(form);
    const busNumber = formData.get('bus-id'); // Assuming 'bus-id' is the name of your input field

    // Now you can use the busNumber to perform your desired action
    console.log('Bus number entered:', busNumber);
});
</script>


    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: {lat: -34.397, lng: 150.644} // Example coordinates
            });
            // Add your logic here to track the bus and update the map
        }
        // Load the map when the page is loaded
        google.maps.event.addDomListener(window, 'load', initMap);
    </script>
    <div class="container"> 
        <div class="bus-info">
            <h3 style="text-align: center;"><p><strong>Bus  Information: </p></strong></h3>
            <p><strong>Bus ID:</strong> 12345</p>
            <p><strong>Route:</strong> Downtown to Uptown</p>
            <p><strong>Next Stop:</strong> Central Station</p>
            <p><strong>ETA:</strong> 5 minutes</p>
        </div>
    </div>

    
</body>
</html>
