<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Tracker</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-WfpA6XxMFUnkpwYmNp/ItwMmuUaQOULiywzCW7bcUjA=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WfpA6XxMFUnkpwYmNp/ItwMluUaQOULiywzCW7bcUjA=" crossorigin=""></script>
</head>
<style>
    body {
       font-family: 'Arial', sans-serif;
       background-color: #f4f4f4;
    }
    .container {
       max-width: 960px;
       margin: 0 auto;
       padding: 20px;
    }
    .map-container {
       height: 500px;
       width: 100%; /* Ensure it consumes the whole width */
       background-color: #d3d3d3; /* Light grey */
       border-radius: 10px;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
       margin-top: 20px; /* Adjust the top margin as needed */
    }
    .bus-info {
       background-color: #fff;
       border-radius: 10px;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
       padding: 30px;
       margin-top: 20px;
    }
    .bus-info h3 {
       margin-bottom: 10px;
    }
    .bus-info p {
       margin-bottom: 0;
    }
    .form-group {
       margin-top: 20px;
    }
    .btn-primary {
       background-color: #007bff;
       border-color: #007bff;
    }
    .btn-primary:hover {
       background-color: #0056b3;
       border-color: #004489;
    }
    /* Updated styles for the header */
    h1.text-center {
       text-decoration: underline; /* Underline the text */
       font-weight: bold; /* Make the text bold */
       font-size: 2.5em;
       margin-bottom: 20px;
       background: linear-gradient(to right, #007bff, #00ff7f);
       -webkit-background-clip: text;
       background-clip: text;
       -webkit-text-fill-color: transparent;/* Added margin for spacing */
    }
    .header-strip {
       background-color: transparent;
       padding: 0px;
       
       margin: 10px;
    
    }
    
   </style>
   
<body>
    <div class="header-strip">
        <h1 class="text-center mb-4">Bus Tracker</h1>
    </div>
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-8">
        <div class="map-container rounded shadow-sm" style="height: 500px;">
            <iframe
            width="100%"
            height="100%"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed/v1/place?key=AIzaSyCL83z4dnE4OrdN68I82aE54BSa6nraI7w&q=Space+Needle,Seattle+WA">
         </iframe>
        </div>
      </div>
      <div class="col-md-4">
        <div class="bus-info border rounded shadow-sm p-4">
          <h3>Bus Information</h3>
          <p><strong>Bus ID:</strong> --</p>
          <p><strong>Route:</strong> --</p>
          <p><strong>Next Stop:</strong> --</p>
          <p><strong>ETA:</strong> --</p>
        </div>
        <div class="form-group mt-4">
          <label for="bus-number">Find Bus:</label>
          <input type="number" class="form-control" id="bus-number" placeholder="Enter Bus Number">
          <button type="button" class="btn btn-primary mt-2" onclick="findBus()">Search</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getDatabase, onValue, ref, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
    import { logEvent } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
    import { setUserProperties } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
    import { setCurrentScreen } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";

    // Your Firebase project configuration
    const firebaseConfig = {
    apiKey: "AIzaSyDBOA_8ILXj-gheePc1LwkMW2H1nPwMQrw",
    authDomain: "gonav-9a614.firebaseapp.com",
    projectId: "gonav-9a614",
    storageBucket: "gonav-9a614.appspot.com",
    messagingSenderId: "259436553742",
    appId: "1:259436553742:web:90d8ddbd7b66f45754fe5f",
    measurementId: "G-VQPGBMN9CB"
  };

    // Initialize Firebase app
    const app = initializeApp(firebaseConfig);

    // Get a reference to the database
    const database = getDatabase(app);

    // Example: Track a page view
    logEvent(analytics, 'page_view', {
     page_location: window.location.href,
     page_path: window.location.pathname,
     page_title: document.title,
    });

    // Example: Track a button click event
    document.getElementById('myButton').addEventListener('click', () => {
     logEvent(analytics, 'button_click', {
         button_id: 'myButton',
         button_name: 'Submit',
     });
    });

    // Example: Set user properties
    setUserProperties(analytics, {
     sign_up_method: 'email',
    });

    // Example: Track user engagement on a specific screen
    setCurrentScreen(analytics, 'Home');

    // Reference to bus location data in Firebase Realtime Database
    const busDataRef = ref(database, 'busLocations');

    // Initialize Leaflet map
    var map = L.map('map-container').setView([34.0522, -118.2437], 13); // Example coordinates

    // Add base layer (replace with your preferred tile provider)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

    // Function to listen for changes in bus locations (real-time updates)
    function listenForBusLocations() {
      onValue(busDataRef, (snapshot) => {
        const busLocations = []; // Initialize an empty array to store bus data

        // Extract data from the snapshot
        snapshot.forEach((childSnapshot) => {
          const busData = childSnapshot.val(); // Get data for each bus
          busLocations.push(busData); // Add bus data to the array
        });

        try {
          // Update bus markers and information if data is valid
          updateBusMarkers(busLocations);
        } catch (error) {
          console.error("Error fetching bus data:", error);
          // Handle the error gracefully, e.g., display an error message to the user
        }
      });
    }

    // Function to update bus information section
    function updateBusInfo(busData) {
      document.getElementById("bus-info-id").textContent = busData.id;
      document.getElementById("bus-info-route").textContent = busData.route;
      // You can similarly update next stop and ETA based on your data structure
    }

    // Function to find a specific bus by number and update map/info
    function findBus() {
      const busNumber = document.getElementById("bus-number").value;

      if (!busNumber) {
        alert("Please enter a bus number to search.");
        return;
      }

      // Create a query to filter bus data based on bus number
      const busQuery = query(busDataRef, orderByChild('id'), equalTo(busNumber));

      onValue(busQuery, (snapshot) => {
        const foundBuses = [];

        // Check if any bus matches the search criteria
        snapshot.forEach((childSnapshot) => {
          foundBuses.push(childSnapshot.val());
        });

        if (foundBuses.length > 0) {
          // Clear existing markers and update with the found bus
          map.eachLayer(function(layer) {
            if (layer instanceof L.marker) {
              map.removeLayer(layer);
            }
          });

          const busData = foundBuses[0]; // Assuming the first bus for now
          updateBusMarkers([busData]); // Update markers with the found bus data
          updateBusInfo(busData); // Update information section
        } else {
          alert("Bus not found. Please try a different number.");
        }
      });
    }

    // Call listenForBusLocations to start listening for real-time updates
    listenForBusLocations();
  </script>

</body>

</html>
